<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Você está convidado(a)!</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Marck+Script&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Glass+Antiqua&family=Marcellus&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
  <body>
    <div class="container">
      <header class="space-1">
        <div class="title">
          <h4>Despedida de</h4>
          <h2>Sarah Hastemberg</h2>
        </div>
      </header>
      <main class="space-2">
        <div class="envelope-container" onclick="handleFlapClick()">
          <!-- Retângulo principal (corpo do envelope) -->
          <div class="envelope-body">
            <!-- Sombra interna -->
            <div class="inner-shadow"></div>

            <!-- Imagem centralizada -->
            <div class="center-image">
              <img
                src="./img/selo_da_carta.png"
                alt="Selo"
                class="seal-image"
              />
            </div>
          </div>

          <!-- Meio losango (aba superior) -->
          <div class="envelope-flap">
            <div class="flap-shape" id="flap">
              <!-- Highlight na aba -->
              <div class="flap-highlight"><p>Abra aqui!</p></div>
            </div>
          </div>
        </div>
      </main>
      <section class="space-3">
        <div class="rose-content">
          <img src="./img/rosas.png" alt="Selo" class="roses-image" />
        </div>
      </section>
      <footer class="space-4">
        <div class="waves">
          <img src="./img/ondas.png" alt="" />
        </div>
      </footer>

      <!-- Convite -->

      <div class="invitation">
        <button class="close-btn" onclick="closeInvitation()">×</button>
        <div>
          <img src="./img/seu-convite.png" alt="Conteudo da carta" />
        </div>
        <div class="buttons-panel">
          <button onclick="openLocal()"></button>
          <button onclick="openSuggestion()"></button>
        </div>
      </div>

      <!-- Sugestão de presente -->

      <div class="suggestion">
        <button class="back-btn" onclick="closeSuggestion()">←</button>
        <div>
          <img src="./img/gift_suggestion.png" alt="Conteudo da carta" />
        </div>
        <div class="pix-container">
          <button class="copy-pix-btn" onclick="copyPix()">
            Copiar chave PIX
          </button>
          <p id="pix-msg" class="hidden">Chave PIX copiada! Muito obrigado.</p>
        </div>
      </div>

      <!-- Local da festa -->

      <div class="local">
        <button class="back-btn" onclick="closeLocal()">←</button>
        <div class="local-image-container">
          <img src="./img/local_party.png" alt="Local da festa" />
          <div id="map" class="map-overlay"></div>
        </div>
      </div>
    </div>

    <script>
      let isOpen = false;
      let leafletMap;

      function copyPix() {
        const chave = "705.232.702-32";
        const msg = document.getElementById("pix-msg");

        navigator.clipboard
          .writeText(chave)
          .then(() => {
            msg.classList.remove("hidden");
            msg.classList.add("show");

            setTimeout(() => {
              msg.classList.remove("show");
              msg.classList.add("hidden");
            }, 3000);
          })
          .catch(() => {
            msg.textContent = "Erro ao copiar!";
            msg.classList.remove("hidden");
            msg.classList.add("show");

            setTimeout(() => {
              msg.classList.remove("show");
              msg.classList.add("hidden");
            }, 3000);
          });
      }

      function handleFlapClick() {
        const flap = document.getElementById("flap");
        const invitation = document.querySelector(".invitation");

        isOpen = !isOpen;

        flap.classList.toggle("open");

        if (isOpen) {
          invitation.classList.add("show");
        } else {
          invitation.classList.remove("show");
        }
      }

      function closeInvitation() {
        const flap = document.getElementById("flap");
        const invitation = document.querySelector(".invitation");
        isOpen = false;
        flap.classList.remove("open");
        invitation.classList.remove("show");
      }

      function openSuggestion() {
        const suggestion = document.querySelector(".suggestion");
        suggestion.classList.add("show");
      }

      function closeSuggestion() {
        const suggestion = document.querySelector(".suggestion");
        suggestion.classList.remove("show");
      }

      function openLocal() {
        const local = document.querySelector(".local");
        local.classList.add("show");

        // inicializa ou redimensiona o mapa após a div aparecer
        setTimeout(() => {
          if (!leafletMap) {
            leafletMap = L.map("map", {
              center: [-3.051171831298931, -59.92135129750051],
              zoom: 15,
            });

            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
              attribution:
                '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            }).addTo(leafletMap);

            L.marker([-3.051171831298931, -59.92135129750051])
              .addTo(leafletMap)
              .bindPopup("Aqui será a festa!")
              .openPopup();
          } else {
            // força o Leaflet a recalcular tamanho
            leafletMap.invalidateSize();
          }
        }, 300);
      }

      function closeLocal() {
        document.querySelector(".local").classList.remove("show");
      }
    </script>
  </body>
</html>
